<template>
    <div class="slds-form-element slds-m-around_medium sld slds-col slds-size_1-of-3">
        <label class="slds-form-element__label" for="searchBox">Select ProjectCode</label>
        <div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right">
             <template if:false={selectedRecord}>
                <svg class="slds-icon slds-input__icon slds-input__icon_right slds-icon-text-default" aria-hidden="true">
                    <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#search"></use>
                </svg>
            </template>
            <template if:true={selectedRecord}>
                <button class="slds-input__icon slds-input__icon_right slds-button_icon" onclick={clearSelection} title="Clear selection">
                    <svg class="slds-button__icon" aria-hidden="true">
                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close"></use>
                    </svg>
                </button>
            </template>
            <input
                id="searchBox"
                type="text"
                class="slds-input"
                placeholder="Search Project Code / Opportunity"
                value={searchKeyword}
                oninput={handleUserSearch}
            />
        </div>

        <template if:true={showDropdown}>
            
            <ul class="slds-listbox slds-listbox_vertical slds-dropdown slds-dropdown_fluid slds-dropdown_length-5"
                role="listbox">
                <template for:each={searchResults} for:item="item">
                    <li key={item.Id}
                        class="slds-listbox__item"
                        onclick={handleSelect}
                        data-id={item.Opportunity__c}
                        data-name={item.Opportunity__r.Name}
                        data-code={item.Opportunity__r.Project_Code__c}>
                        <div class="slds-media slds-listbox__option slds-listbox__option_entity slds-p-horizontal_small"
                             role="option">
                            <span class="slds-media__body">
                                <span class="slds-truncate" title={item.Opportunity__r.Name}>
                                    <b>{item.Opportunity__r.Project_Code__c}</b> 
                                </span>
                            </span>
                        </div>
                    </li>
                </template>
            </ul>
        </template>
    </div>

    <template if:true={selectedRecord}>
        <div class="slds-m-left_medium">
            <lightning-button
                variant="brand"
                label="Extract TimeSheet"
                onclick={handleExtract}
                title="Download action"
                icon-name="utility:download"
                icon-position="right">
            </lightning-button>
        </div>
    </template>
</template>